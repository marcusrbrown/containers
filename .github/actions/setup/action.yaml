---
# Based on https://github.com/bfra-me/works/blob/7217b637351a0b251d1d0c2158614210c7efdad0/.github/actions/pnpm-install/action.yaml
name: Setup
description: Setup build environment and install dependencies

inputs:
  cache-version:
    default: '0'
    description: Cache version. Can be incremented to invalidate the cache.
    required: false

runs:
  steps:
    - name: Install mise
      env:
        MISE_VERSION: 2025.12.0 # renovate: datasource=github-releases packageName=jdx/mise
      uses: jdx/mise-action@6d1e696aa24c1aa1bcc1adea0212707c71ab78a8 # v3.6.1
      with:
        version: ${{ env.MISE_VERSION }}

    - name: Setup Python
      uses: actions/setup-python@a309ff8b426b58ec0e2a45f0f869d46889d02405 # v6.2.0
      with:
        cache: poetry
        python-version-file: 'pyproject.toml'

    - name: Install dependencies
      run: poetry install
      shell: 'bash -Eeuo pipefail {0}'

  using: composite
